{% extends "admin/base_site.html" %}
{% load i18n %}

{% block content %}
<div id="content-main">
  <div class="module">
    <h2>
      <a href="/admin/task/gputask/#/admin/task/gputask/">GPUä»»åŠ¡</a>
      {% if project %}
        / Project: {{ project.name }}
      {% else %}
        / Project
      {% endif %}
    </h2>

    {% if project %}
      <ul class="object-tools">
        <li>
          <a href="/admin/task/taskgroup/add/?project={{ project.id }}#/admin/task/taskgroup/add/" class="addlink">æ–°å¢ Group</a>
        </li>
        <li>
          <a href="/admin/task/project/{{ project.id }}/change/#/admin/task/project/{{ project.id }}/change/">ç¼–è¾‘ Project</a>
        </li>
      </ul>
    {% endif %}

    {% if not project %}
      <p>{% trans "Project not found." %}</p>
    {% else %}
      {% if groups %}
        <div style="display:flex;flex-wrap:wrap;gap:12px;">
          {% for g in groups %}
            <div class="module" style="padding:12px;min-width:240px;">
              <a
                href="/admin/task/gputask/group/{{ g.id }}/"
                data-open-tab="1"
                data-tab-url="/admin/task/gputask/group/{{ g.id }}/"
                data-tab-eid="gputask-group-{{ g.id }}"
                data-tab-name="Group: {{ g.name }}"
              >ğŸ“ {{ g.name }}</a>
              <span style="margin-left:8px;">
                <a href="/admin/task/taskgroup/{{ g.id }}/change/#/admin/task/taskgroup/{{ g.id }}/change/">ç¼–è¾‘</a>
              </span>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p>{% trans "No groups." %}</p>
      {% endif %}
    {% endif %}
  </div>
</div>

<script>
  (function () {
    function tryOpenTab(url, name, eid) {
      try {
        var app = window.parent && window.parent.app;
        if (app && typeof app.openTab === 'function') {
          var payload = { url: url, name: name };
          if (eid) payload.eid = eid;
          app.openTab(payload);
          return true;
        }
      } catch (e) {}
      return false;
    }

    document.addEventListener(
      'click',
      function (e) {
        var target = e.target;
        var a = target && target.closest ? target.closest('a[data-open-tab="1"]') : null;
        if (!a) return;
        var url = a.getAttribute('data-tab-url') || a.getAttribute('href');
        var name = a.getAttribute('data-tab-name') || (a.textContent || '').trim();
        var eid = a.getAttribute('data-tab-eid');
        if (!url) return;
        if (tryOpenTab(url, name, eid)) {
          e.preventDefault();
          e.stopPropagation();
        }
      },
      true
    );
  })();
</script>
{% endblock %}
